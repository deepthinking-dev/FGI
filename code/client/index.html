
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit"/>
    <title>topology-es5</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.5 -->
    <link href="./plugins/bootstrap/3.3.5/bootstrap.min.css" rel="stylesheet">
    <link href="./plugins/bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css" rel="stylesheet">
    <link href="./plugins/topology/layout.css" rel="stylesheet">
    <link href="./lkr.css" rel="stylesheet">
    <link href="./LogicMath.css" rel="stylesheet">
    <link href="./toastr.css" rel="stylesheet">
    <!-- <link href="css/lanrenzhijia.css" type="text/css" rel="stylesheet" /> -->
    <!-- 矢量图标库 -->
    <link href="http://at.alicdn.com/t/font_1113798_0532l8oa6jqp.css" rel="stylesheet"/>
    <link href="http://at.alicdn.com/t/font_1331132_5lvbai88wkb.css" rel="stylesheet"/>
    <style>
        .left-list{
            width: 75%;
            margin: auto;
            margin-top: 10px;
            /* border: 1px solid black; */
        }
        .left-list-event{
            border: 1px dashed #4295ec;
            display: flex;
            justify-content: space-between;
        }
        .left-list-tilte{
            height: 100px;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url(./static/mum1.png);
            background-size: 100% 100%;
            background-repeat: no-repeat;
        }
        
    </style>
     <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            showProcessingMessages: false,
            tex2jax: { inlineMath: [['$','$'],['\\(','\\)']] }
        });
    </script>
    <script type="text/javascript" src="./MathJax/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
    <script src="./plugins/bootstrap/3.3.5/bootstrap.min.js"></script>
    <script src="./plugins/jquery/3.3.1/jquery-3.3.1.min.js"></script>
    <script src="./topology/formula.js"></script>
    <script src="./toastr.js"></script>
    <script>
        $(function() {
            var content = "";
            var Preview = {
            delay: 150,        
            preview: null,    
            buffer: null,      
            timeout: null,     
            mjRunning: false,  
            mjPending: false,  
            oldText: null,    
            Init: function () {
                this.preview = document.getElementById("MathPreview");
                this.buffer = document.getElementById("MathBuffer");
            },
            SwapBuffers: function () {
                var buffer = this.preview, preview = this.buffer;
                this.buffer = buffer; this.preview = preview;
                buffer.style.visibility = "hidden"; buffer.style.position = "absolute";
                preview.style.position = ""; preview.style.visibility = "";
            },
            Update: function () {
                var value = document.getElementById("MathInput").value
                if (this.timeout) {clearTimeout(this.timeout)}
                this.timeout = setTimeout(this.callback,this.delay);
            },
            CreatePreview: function () {
                Preview.timeout = null;
                if (this.mjPending) return;
                var text = "`" + document.getElementById("MathInput").value + "`";
                if (text === this.oldtext) return;
                if (this.mjRunning) {
                    this.mjPending = true;
                    MathJax.Hub.Queue(["CreatePreview",this]);
                } else {
                    this.buffer.innerHTML = this.oldtext = text;
                    this.mjRunning = true;
                    MathJax.Hub.Queue(
                        ["Typeset",MathJax.Hub,this.buffer],
                        ["PreviewDone",this]
                    );
                }
            },
            PreviewDone: function () {
                this.mjRunning = this.mjPending = false;
                this.SwapBuffers();
            }
        };
        function changeBds(value) {
            document.getElementById("MathInput").value = value
            Preview.Update()
        };
        parent.changeBds = changeBds
        Preview.callback = MathJax.Callback(["CreatePreview",Preview]);
        Preview.callback.autoReset = true;  
        Preview.Init();
        Preview.Update();
        
        $("#MathInput").on("input", function(val) {
            content = "$"+$(this).val()+"$";
            let contentVal = $(this).val()
            Preview.Update();
            $.ajax({
                type:"get",   
                url:urlConfig.host+'/mark/getMark',
                data:{
                    target:$(this).val()
                },
                success: function(data) {
                   data = window.formula(data);
                    let  str = ''
                    data.map(item => {
                        str +=`<div class="MathJaxParam">
                                <div class="width-50">
                                    <span>变量</span>
                                    <input type="text"  readonly="readonly" value="${item}" class="MathJaxInput1 inputButton">
                                </div>
                                <div class="width-50 width-select">
                                    <span>类型</span>
                                    <select id="" class="MathJaxInput2 inputButton" >
                                        <option value="2">常量</option>
                                        <option value="1">基本类型</option>
                                    </select>
                                </div>
                                <div class="width-50 isShow1"> 
                                        <span>取值</span>
                                        <input type="text" class="MathJaxInput3 inputButton">
                                </div>
                                <div class="width-50 isShow2"> 
                                        <span>数据项</span>
                                        <select class="MathJaxSelect MathJaxInput1 inputButton">
                                            <option>byte</option>
                                            <option>short</option>
                                            <option>int</option>
                                            <option>long</option>
                                            <option>float</option>
                                            <option>double</option>
                                            <option>boolean</option>
                                            <option>char</option>
                                            <option>date</option>
                                            <option>string</option>
                                            <option>BLOB</option>
                                            <option>boolean</option>
                                            <option>array</option>
                                        </select>
                                </div>
                                <div class="width-50"> 
                                        <span>描述</span>
                                        <input type="text" class="MathJaxInput4 inputButton">
                                </div>
                            </div>`                       
                    })
                    $(".MathJaxEdit").html(str)    
                }
            })  
        });
    });
</script>
</head>
<body> 
       <!-- 关系选择 -->
       <div id="ruleAct">
        <div>
            <select class="actionSelected1">
                <option value="1">输出</option>
                <option value="0">输入</option>
            </select>
            <select class="actionSelected2" style="margin: 20px 0">

            </select>
            <input value="" id="varTypeInput" readonly>
            <button class="btn pointer" type="button" onclick="ActionClose()" style="margin-right: 35px;background: #f56c6c;color: #fff">取消</button>
            <button class="btn pointer" type="button" onclick="ActionSure(event)" style="margin-right: 10px;background: #409eff;color: #fff">确定</button>
        </div>
    </div>
    <!-- 保存规则 -->
    <div id="sureRule">
        <div class="title">
            <span>保存规则</span>
            <span onclick="RuleClose()" style="cursor: pointer;">X</span>
        </div>
        <div class="ruleContent"> 
            <li><span>规则名称：</span><input id="ruleName" type="text" placeholder="请输入规则名称"></li>
            <li><span>规则描述：</span><input id="ruleRemark" type="text" placeholder="请输入规则描述"></li>
            <li><span>备注：</span><input id="ruleDes" type="text" placeholder="请输入规则备注"></li>
            <button id="saveRule" onclick="ruleSure()">确定</button>
        </div>
    </div>
     <!-- fgi模型表 -->
    <div id="sourceName" class="lkr-frame" style="z-index: 999999; display: none;">
        <div class="lkr-frame-div" style="height: 520px;">
            <div class="lkr-source-tilte">
                连接数据源
                <span style="cursor: pointer;" onclick='sourceNameClose()'>x</span>
            </div>
            <div id="addSource" class="addSource">
                <select id='fgiName' class="lkr-select">
                    <option>卫星信号规格参数A表</option>
                </select>
                <table class="lkr-table" border="1">
                    <thead>
                        <tr>
                        <td>
                            <input type="checkbox" name="item" id="selectAll"/>
                        </td>
                        <td>
                            字段英文
                        </td>
                        <td>
                            字段中文
                        </td>
                        <td>
                            字段类型
                        </td>
                        <td>
                            字段描述
                        </td>
                        <td>
                            是否主键
                        </td>
                        </tr>
                    </thead>
                    <tbody>
                    
                    </tbody>
                </table>
            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='sourceNameConfirm()'>确定</div>
            </div>
        </div>
        
        
    </div>
    <!-- 新建/编辑算子 -->
    <div class="lkr-frame" id='AddAlgorithm'>
        <div class="lkr-frame-div" style="height: 350px;">
            <div class="lkr-frame-tilte">
                新建/编辑算子
                <span style="cursor: pointer;" onclick='AlgorithmClose()'>x</span>
            </div>
            <div class="lkr-frame-content">
<!--                <div style="margin: 15px 0;display: flex;align-items: center;">-->
<!--                    <label style="line-height: 10px;width: 100px;">作者：</label>-->
<!--                    <input id="szAuthor" type='text' class="lkr-input" style="flex:1;margin-left: 10px;"/>-->
<!--                </div>              -->
<!--                <div style="margin: 15px 0;display: flex;align-items: center;">-->
<!--                    <label style="line-height: 10px;width: 100px;">描述：</label>-->
<!--                    <textarea id="szDes"  type='text' class="lkr-input" style="flex:1;margin-left: 10px;"></textarea>-->
<!--                </div>-->
                <div style="margin: 15px 0;display: flex;align-items: center;">
                    <label style="line-height: 10px;width: 100px;">算子类型：</label>
                    <select id="sfType" class="lkr-select" style="flex: 1;margin-left: 10px;">
                        <option>算法公式</option>
                        <option>逻辑运算</option>
                    </select>                    
                </div>
            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='AlgorithmConfirm()'>确定</div>
            </div>
        </div>
        
    </div>
    <!-- 数据模型 -->
    <div id="dataModulePage" class="modulePage">
        <div class="title">
            <span>数据模型</span>
            <span onclick="ModuleClose()" style="cursor: pointer;">X</span>

        </div>
        <div class="addButtonModlue">
            <button class="addModlue" onclick="addModule()">新增</button>
            <span style="color: #409eff;height: 30px;line-height: 30px;margin: 0 10px">模型组</span>
            <select id="selectedModlue">
                <option value=""></option>
            </select>
        </div>

        <div class="moduleContentList">
        </div>
    </div>
    <!-- 算子确认删除框 -->
    <div class="lkr-frame" id='lkrRule'>
            <div class="lkr-frame-div" style="height: 150px;">
                <div class="lkr-frame-content">
                    <h3>
                        确认删除此规则?
                    </h3>
                    
                </div>
                <div class="lkr-frame-foot">
                    <div class="lkr-button" onclick='ConfirmDelRule()' style="margin-right: 10px;">确定</div>
                    <div class="lkr-button" onclick='ruleDelClose()'>取消</div>
                </div>
            </div>
        </div>
    <!-- 关系选择 -->
    <div id="selectRela">
        <div>
            <span>关系选择</span>
            <select class="selectRelation">
                    <option value="">与</option>
                    <option value="">或</option>
                    <option value="">非</option>
                    <option value="">大于 </option>
                    <option value="">大于等于</option>
                    <option value="">小于 </option>
                    <option value="">小于等于</option>
                    <option value="">等于</option>
                    <option value="">不等于</option>
            </select>
            <span>规则描述</span>
            <textarea cols="21" rows="5"></textarea>
            <button class="btn pointer" type="button" onclick="RelateClose()" style="margin-right: 35px;">取消</button>
            <button class="btn pointer" type="button" onclick="selectSure()" style="margin-right: 10px;">确定</button>
        </div>
    </div>
    <!-- 上传导入文件框 -->
    <div id="fileupload">
        <div class="title">
            <span>上传文件</span>
            <span onclick="uploadClose()" style="cursor: pointer;">X</span>
        </div>
        <!-- <div id="fileUploadContent" class="fileUploadContent"></div> -->

        <form class="uploadForm" name="uploadForm">
            <input class="inputfile" name="inputfile" type="file" multiple="multiple" onchange="getvl(this)"
            accept="application/json,text/plain,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,text/xml, application/xml"/>
            <!-- <div class="formContent" >
                <span>文件名称</span>
                <span>xxx.txt</span>
                <button>删除</button>
            </div>
            -->
        </form>
        <button class="btn btn-primary mr10 btn-sm pointer" type="button" onclick="uploadSure()">确定</button>
    </div>
    <!-- 所有公式弹框 -->
    <div id="otherFormula">
            <div class="title">
                <span>算子信息</span>
                <span onclick="fieldsClose()" style="cursor: pointer;">X</span>
            </div>
            <div class="otherFormulaContent">
                <table class="table">
                    <thead>
                        <tr>
                            <th>算子名称</th>
                            <th>算子类型</th>
                            <th>公式预览</th>
                            <th>算子作者</th>
                            <!-- <th>算子描述</th> -->
                        </tr>
                    </thead>
                    <tbody class="otherFormulaList" style="height:320px">
                        
                    </tbody>
                </table>                     
            </div>
            <div class="frame-foot">
                <div class="button" onclick='ConfirmotherFormula()'>确定</div>
            </div>
        </div>
    <!-- 数据项选择字段信息弹框 -->
    <div id="fields">
        <div class="title">
            <span>字段信息</span>
            <span onclick="fieldsClose()" style="cursor: pointer;">X</span>
        </div>
        <div class="fieldsContent">
            <table class="table">
                <thead>
                    <tr>
                        <th>字段名称</th>
                        <th>字段类型</th>
                        <th>字段描述</th>
                    </tr>
                </thead>
                <tbody class="fieldsList" style="height:320px">
                    
                </tbody>
            </table>                     
        </div>
        <div class="frame-foot">
            <div class="button" onclick='ConfirmFields()'>确定</div>
        </div>
    </div>
    <!-- 选择算子类型 -->
    <!-- <div id="suanfaType">
        <div class="suanzi">
            <select placeholder="选择算子类型" id="formulaType">
                <option value="" >请选择算子类型</option>
                <option value="1" >算法公式</option>
                <option value="2">逻辑运算</option>
            </select>
            <div>
                <button onclick="selectFormula()">确定</button>
            </div>
        </div>
    </div> -->
    <!-- 公式编辑 -->
    <div class="Frame">
        <div class="title">
            <span>公式编辑</span>
            <span onclick="FrameClose()" style="cursor: pointer;color:#fff;float: right;">X</span>
        </div>
        <div class="form-group">
            <div id="authorShow">
                <div>
                    <span class="form-span">作者</span>
                    <input id="gsName" type="text" >
                </div>
                <div>
                    <span class="form-span">描述</span>
                    <input id="gsDes" type="text" >
                </div>
            </div>
            <div>
                <span class="form-span">算子名称<span style="color: red;font-size: 16px;display: inline-block">*</span></span>
                <input id="AlgorithmnameY" type="text" >
            </div>
            <div class="AlgorithInput">
                <span class="form-span">公式编辑<span style="color: red;font-size: 16px;display: inline-block">*</span></span>
                <input id="MathInput" onblur="Preview.Update()" type="text" >
            </div>
                <div>
                    <span  class="form-span">公式预览</span>
                    <div id="MathPreview" ></div>
                    <div id="MathBuffer" style="font-size: 20px;visibility:hidden; position:absolute; top:0; left: 0;margin: 0 auto;"></div>
                </div>

        </div>
        <div class="form-group MathJaxEdit">
        </div>     
        <div class="frame-foot">
            <div class="button closeGsButton" onclick='ConfirmFrame()'>确定</div>
        </div>
    </div>
    <!-- 逻辑运算 -->
    <div class="Logic">
        <div class="title">
            <span>逻辑运算</span>
            <span onclick="LogicClose()" style="cursor: pointer;color:#fff;float: right;">X</span>
        </div>
        <div class="LogicContent ">
            <button class="addButton" onclick="addLogic()">新增</button>
            <div>
                <span class="form-span">作者</span>
                <input id="ljName" type="text">
            </div>
            <div style="margin-top: 10px;">
                <span class="form-span">描述</span>
                <input id="ljDes" type="text">
            </div>
            <div style="margin-top: 10px;">
                <span class="form-span">逻辑运算名称<i style="color: red;font-size: 16px;display: inline-block">*</i></span>
                <input id="LogicName" type="text">
            </div>
            <div>
                <form class="logicForm">
                    <ul class="logicUl">
                        <li class="logicLi">
                            <select name="" class="Logic-form-field inputButton">
                                <option value="">请选择字段</option>
                            </select>
                            <select name="" class="Logic-form-label inputButton">
                                <option value="">与</option>
                                <option value="">或</option>
                                <option value="">非</option>
                                <option value="">&lt; </option>
                                <option value="">&lt;=</option>
                                <option value="">&gt; </option>
                                <option value="">&gt;=</option>
                                <option value="">=</option>
                            </select>
                            <!-- <select name="" class="Logic-form-value inputButton">
                                <option value="">请选择取值</option>
                            </select>  -->
                            <input type="text" class="Logic-form-value inputButton">
                            <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                        </li>
                    </ul>
                </form>
            </div>
        </div>
        <div class="frame-foot">
            <div class="button closeLjButton" onclick='ConfirmLogic()'>确定</div>
        </div>
    </div>
    <!-- 算子确认删除框 -->
    <div class="lkr-frame" id='lkrAlgorithm'>
        <div class="lkr-frame-div" style="height: 150px;">
            <div class="lkr-frame-content">
                <h3>
                    确认删除此算子?
                </h3>
                
            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='ConfirmDelAlgorithm()' style="margin-right: 10px;">确定</div>
                <div class="lkr-button" onclick='AlgorithmeDelClose()'>取消</div>
            </div>
        </div>
    </div>
    <div class="lkr-frame" id='lkrFrameDel'>
        <div class="lkr-frame-div" style="height: 150px;">
            <!-- <div class="lkr-frame-tilte">
                删除
                <span style="cursor: pointer;" onclick='lkrFrameDelClose()'>x</span>
            </div> -->
            <div class="lkr-frame-content">
                <h3>
                    确认删除?
                </h3>
                
            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='ConfirmDel()' style="margin-right: 10px;">确定</div>
                <div class="lkr-button" onclick='lkrFrameDelClose()'>取消</div>
            </div>
        </div>
    </div>
    <div class="lkr-frame" id='lkrFrame'>
        <div class="lkr-frame-div">
            <div class="lkr-frame-tilte">
                新建模型
                <span style="cursor: pointer;" onclick='lkrFrameClose()'>x</span>
            </div>
            <div class="lkr-frame-content">
                <div style="margin: 15px 0;display: flex;align-items: center;">
                    <label style="line-height: 10px;width: 120px;text-align: right">模型所属组：</label>
                    <input type='text' id='modulegroup' class="lkr-input"/>
                    <!-- <select class="lkr-select" style="flex: 1;">
                        <option>信号产生模型类型</option>
                    </select> -->
                </div>
                <div style="margin: 15px 0;display: flex;align-items: center;">
                    <label style="line-height: 10px;width: 120px;text-align: right;">模型名称：</label>
                    <input type='text' id='mouldName' class="lkr-input"/>
                    <!-- <select class="lkr-select" style="flex: 1;">
                        <option>信号产生模型类型</option>
                    </select> -->
                </div>
                <div style="margin: 15px 0;display: flex;align-items: center;">
                    <label style="line-height: 10px;width: 120px;text-align: right;">描述：</label>
                    <textarea style="resize: none" type='text' id='mouldRemark' class="lkr-input"></textarea>
                    <!-- <select class="lkr-select" style="flex: 1;">
                        <option>信号产生模型类型</option>
                    </select> -->
                </div>

                <div style="margin: 15px 0;display: flex;align-items: center;">
                    <label style="line-height: 10px;width:120px;text-align: right" class="sjyDiv">链接数据源：</label>
                    <!-- <select id='fgiName' class="lkr-select" style="flex: 1;margin-left: 10px;">
                        <option>卫星信号规格参数A表</option>
                    </select> -->
                    <div id='fgiSource' class="lkr-button">链接数据源</div>

                </div>
                <div id='addMb' >
                    <table class="lkr-table" border="1">
                        <thead>
                          <tr>
                            <td>
                                字段英文
                            </td>
                            <td>
                                字段中文
                            </td>
                            <td>
                                字段类型
                            </td>
                            <td>
                                字段描述
                            </td>
                            <td>
                                是否主键
                            </td>
                            <td>
                                字段表名
                            </td>
                            <td class="operate">
                                操作
                            </td>
                          </tr>
                        </thead>
                        <tbody >

                        </tbody>
                    </table>

                </div>
            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='Confirm()'>确定</div>
            </div>
        </div>

    </div>
    <!-- 连线（lkr） -->
    <div class="lkr-frame" id='ligature'>
        <div class="lkr-frame-div" style="height: 150px;">
            <!-- <div class="lkr-frame-tilte">
                删除
                <span style="cursor: pointer;" onclick='lkrFrameDelClose()'>x</span>
            </div> -->
            <div class="lkr-frame-content">
                <input type='text'  class="lkr-input" style="flex:1;margin-left: 10px;"/>

            </div>
            <div class="lkr-frame-foot">
                <div class="lkr-button" onclick='ligatureConfirm()'>确定</div>
            </div>
        </div>
    </div>

    <!-- 连线（lkr） -->
    <div class="wrapper" style="height: 100%;">
        <!-- Content Wrapper. Contains page content -->
        <div class="content-wrapper">
            <section class="content" id="content">
                <div class="panel panel-default" style="background: rgba(0,0,0,0);border: none;">
                    <div class="panel-body">
                        <nav class="navbar navbar-default" style="padding: 0 10px;background-color: rgba(0,0,0,0);border: none;width: 80%;">
                            <ul class="nav nav-pills">
                                <!-- <li><span>规则名称：</span><input id="ruleName" type="text" placeholder="请输入规则名称"></li>
                                <li><span>规则描述：</span><input id="ruleRemark" type="text" placeholder="请输入规则描述"></li> -->
                                <li><button id="saveRule" onclick="ruleOpen()">保存规则</button></li>
                                <li><button id="Import">导入</button></li>
                                <li><button id="export">导出</button></li>

                            </ul>
                        </nav>
                        <div class="flex lkr-flex" id="main_canvas" >
                            <!-- <div onclick="addFrame()" style="cursor: pointer;">新增</div> -->

                            <div class="lkr-bg-canvas">
                                <div id="flex_canvas">
                                    <div class="canvas" id="topo_canvas"></div>

                                </div>
                            </div>
                        </div>

                        <div class="tools" id="flex_tools" style="position: absolute;right: 30px;border: 1px solid #19386f;border-radius: 7px;">
                            <div class="title-page">
                                <li><span onclick="dataModlue()"><i class="dataMod"></i> 数据模型</span></li>
                                <li><span onclick="dictionaryShow()"><i class="DicI"></i> 字典</span></li>
                            </div>
                            <div class='Search'>
                                <i class="icon-search"></i>
                                <input id="searchName" type='text'  class="lkr-input" style="flex:1;margin: auto;color: white"/>

                            </input>
                            </div>
                           <div id="ruleMde" class='lkr-page' style="display: none;">
                                <button id="getAllSz" class="backAlgorithmPage">返回</button>
                                <div id="rulePage" style="margin-top: 70px;"></div>

                           </div>
                           <div id="algorithmPage" class='lkr-page' ></div>
                           <div class="mouldFoot">
                                <div onclick='editAlgorithm()'>编辑算子</div>
                                <div id='getAllGzgz'>已有规则</div>
                            </div>

                        </div>
                    <!--右键菜单定义-->
                    <div class="context-menus" id="canvas_menus" style="display: none">
                        <div disabled>
                            <a onclick="onTops()" class="menu-a-disabled" disabled>
                                新增自定义属性
                            </a>
                        </div>
                        <div>
                            <a class="menu-a" id="showAllmag">
                                查看详情
                            </a>
                        </div>
                        <div disabled>
                            <a onclick="onTop()" class="menu-a-disabled" id="menu_top" disabled>
                                置顶
                            </a>
                        </div>
                        <div>
                            <a onclick="onBottom()" class="menu-a-disabled" id="menu_bottom" disabled>
                                置底
                            </a>
                        </div>
                        <div class="line"></div>
                        <div>
                            <a onclick="onCombine()" class="menu-a-disabled" id="menu_combine" disabled>
                                组合
                            </a>
                        </div>
                        <div>
                            <a onclick="onUncombine()" class="menu-a-disabled" id="menu_unCombine" disabled
                            style="display: none">
                                取消组合
                            </a>
                        </div>
                        <div>
                            <a onclick="onLock()" class="menu-a-disabled" id="menu_lock" disabled>
                                锁定
                            </a>
                        </div>
                        <div class="line"></div>
                        <div>
                            <a onclick="onDelete()" class="menu-a">
                                删除
                            </a>
                        </div>
                        <div class="line"></div>
                        <div>
                            <a onclick="undo()" class="menu-a">
                                撤消
                                <span class="ml50">Ctrl + Z</span>
                            </a>
                        </div>
                        <div>
                            <a onclick="redo()" class="menu-a">
                                恢复
                                <span class="ml50">Ctrl + Shift+ Z</span>
                            </a>
                        </div>
                        <div class="line"></div>
                        <div>
                            <a onclick="cut()" class="menu-a">
                                剪切
                                <span class="ml50">Ctrl + X</span>
                            </a>
                        </div>
                        <div>
                            <a onclick="copy()" class="menu-a">
                                复制
                                <span class="ml50">Ctrl + C</span>
                            </a>
                        </div>
                        <div>
                            <a onclick="parse()" class="menu-a">
                                粘贴
                                <span class="ml50">Ctrl + V</span>
                            </a>
                        </div>
                    </div>
                </div>
                </div>
            </section>
            <!-- /.content -->
        </div>
        <!-- /.content-wrapper -->

    </div>
      <!-- 字典信息弹窗 -->
      <div id="dicDiv">
      <div class="title">
          <span>字典信息</span>
          <span class="dicDivClose" style="color:#fff;float: right;cursor: pointer;">X</span>
      </div>
          <div style="position: relative;top:70px;margin: 0 auto;margin-left: 30px">
              <input type="button" id="addDic" value="新增">
              <table id="dicTable">

              </table>
          </div>
    </div>
    <!-- 字典新增修改弹窗 -->
    <div id="editDic">
        <div class="title">
            <span id="editDicTitle">新增字典</span>
            <span id="dictordySpan" class="editDicClose" style="color:#fff;float: right;cursor: pointer;">X</span>
        </div>
        <div style="position: relative;top: 70px;margin: 0 auto;margin-left: 30px">
            <p>
            <h4 style="color:#fff;margin-left: 30px;color: aqua">基本信息</h4>
            </p>
            <div  style="margin: 10px 0">
                <span> 作 者 </span><input type="text" id="editAuthor">
            </div>
            <div  style="margin: 10px 0">
                <span>算法名称<i style="color: red;font-size: 16px;display: inline-block">*</i></span><input type="text" id="editDicName">
            </div>
            <div>
                <span>算法描述</span><input type="text" id="editDicDes">
            </div>
            <p>
            <h4 style="color:#fff;margin-left: 30px;color: aqua">参数信息</h4>
            <button style="background: #409eff;margin-left: 25px;color: #fff" id="addZdcs">新增参数</button>
            </p>
            <div id="zdcsList">

            </div>
        </div>
        <button id="editDicYes">确定</button>
    </div>
    <div id="colorDiv">
        <ul>
            <li style="background: #0eff23">常量</li>
            <li style="background: #ff00e7">对象</li>
            <li style="background: red">int</li>
            <li style="background: #ff7749">byte</li>
            <li style="background: #a4ff59">long</li>
            <li style="background: #fb61ff">short</li>
            <li style="background: blue">float</li>
            <li style="background: green">double</li>
            <li style="background: aqua">boolean</li>
            <li style="background: orange">number</li>
            <li style="background: #7cc6ff">char</li>
            <li style="background: #ff4286">date</li>
            <li style="background: #00c1ff">string</li>
            <li style="background: #6a46ff">blob</li>
            <li style="background: #ffe964">array</li>
        </ul>
    </div>

<script src="config.js"></script>
<!-- jQuery 3.3.1 -->
<script src="./plugins/jquery/3.3.1/jquery-3.3.1.min.js"></script>
<script src="./plugins/bootstrap/3.3.5/bootstrap.min.js"></script>
<script src="./plugins/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
<script src="./plugins/topology/topology.bundle.js"></script>
<script src='index.js'></script>
<script src="topology/topology_es5.js"></script>
<script src="topology/MathJax.js"></script>

<script>
    window.bigData = {
        mouldParam:[],
        actionTab:'基础模块',
        delmoduleId:'',
        editmoduleId:'',
        frameType:'add',
        editmoduledata:[],
        delAlgorithmId:'',
        editAlgorithmId:'',
        editFormula:'',
        formulaType:'add',
        formulaModuleId:'',
        isAddInOut:false,
        isAddInOutType: 'out'
    }
    window.filed ={
        inputFieldsTarget:'',
        fieldname:''
    }
    $('body').on('click','.lkr-list-edit',(e) => {
        window.bigData.frameType = 'edit'
        window.bigData.editmoduleId = $(e.target).data('id')
        $('#lkrFrame').fadeToggle(500)
        $.ajax({
            url:urlConfig.host+'/module/getModuleById',
            data:{moduleId:window.bigData.editmoduleId},
            success: function(data) {
                // $('#addMb tbody').html('')
                let str =`修改模型
                    <span style="cursor: pointer;" onclick='lkrFrameClose()'>x</span>`
                $(".lkr-frame-tilte").html(str)
                $('.sjyDiv').show();
                $('.operate').show();
                $('#fgiSource').show();
                $("#mouldName").val(data.modulename).removeAttr("readonly")
                $("#modulegroup").val(data.modulegroup).removeAttr("readonly")
                $("#mouldRemark").val(data.des).removeAttr("readonly")
                window.bigData.editmoduleId = data.id
                let thStr=``
                data.modulefields.map(item => {
                    thStr += `<tr id="${item.id}" moduleid="${item.moduleid}">
                    <td class="columnName">${item.fieldname?item.fieldname:''}</td>
                    <td class="columnComment">${item.COLUMN_COMMENT?item.COLUMN_COMMENT:''}</td>
                    <td class="columnType">${item.fieldtype?item.fieldtype:''}</td>
                    <td>${item.LENGTH?item.LENGTH:''}</td>
                    <td>${item.IS_NULLABLE?item.IS_NULLABLE:''}</td>
                    <td class="tableName">${item.tablename?item.tablename:''}</td>
                    <td><button class="delTab">删除</button></td></tr>`
                })
                $('#addMb tbody').html(thStr)

            }
        })
    })
    $('body').on('dblclick','.dbclickModule',(e) =>{
        debugger
        let modlueId= $(e.target).attr('data-id')
        $('#lkrFrame').fadeToggle(500)
        $.ajax({
            url:urlConfig.host+'/module/getModuleById',
            data:{moduleId:modlueId},
            success: function(data) {
                // $('#addMb tbody').html('')
                let str =`模型详情
                    <span style="cursor: pointer;" onclick='lkrFrameClose()'>x</span>`
                $(".lkr-frame-tilte").html(str)
                $('.sjyDiv').hide();
                $('.operate').hide();
                $("#mouldName").val(data.modulename).attr({"readonly":"readonly"});
                $("#modulegroup").val(data.modulegroup).attr({"readonly":"readonly"});
                $("#mouldRemark").val(data.des).attr({"readonly":"readonly"});
                $('#lkrFrame .lkr-button').hide();
                window.bigData.editmoduleId = data.id
                let thStr=``
                data.modulefields.map(item => {
                    thStr += `<tr id="${item.id}" moduleid="${item.moduleid}">
                    <td class="columnName">${item.fieldname?item.fieldname:''}</td>
                    <td class="columnComment">${item.COLUMN_COMMENT?item.COLUMN_COMMENT:''}</td>
                    <td class="columnType">${item.fieldtype?item.fieldtype:''}</td>
                    <td>${item.LENGTH?item.LENGTH:''}</td>
                    <td>${item.IS_NULLABLE?item.IS_NULLABLE:''}</td>
                    <td class="tableName">${item.tablename?item.tablename:''}</td>
                    </tr>`
                })
                $('#addMb tbody').html(thStr)

            }
        })
    })
    function addModule(){
        window.bigData.frameType = 'add'
        let str =`新建模型
            <span style="cursor: pointer;" onclick='lkrFrameClose()'>x</span>`
        $(".lkr-frame-tilte").html(str)
        $('.sjyDiv').show();
        $('.operate').show();
        $('#fgiSource').show();
        $('#lkrFrame').fadeToggle(500)
        $.ajax({
            url:urlConfig.host+'/module/findAllTableFromDB',
            data:'',
            success: function(data) {
                let str = '<option>请选择</option>'
                data.map(item => {
                    str += `<option>${item}</option>`
                })
                $("#fgiName").html(str)
            }
        })
    }
    $("#fgiName").change((e)=>{
        $.ajax({
            url:urlConfig.host+'/module/findAllFiledByTableName',
            data:{
                tableName:$(e.target).val()
            },
            success: function(data) {
                window.bigData.mouldParam = data
                let thStr = ''
                data.map(item => {
                    thStr += `<tr><td><input id='${'chk'+item.COLUMN_NAME}' type="checkbox" name="item" data-id='${item.COLUMN_NAME}'/></td>
                    <td>${item.COLUMN_NAME?item.COLUMN_NAME:''}</td>
                    <td>${item.COLUMN_COMMENT?item.COLUMN_COMMENT:''}</td>
                    <td>${item.COLUMN_TYPE?item.COLUMN_TYPE:''}</td>
                    <td>${item.LENGTH?item.LENGTH:''}</td>
                    <td>${item.IS_NULLABLE?item.IS_NULLABLE:''}</td></tr>`
                })
                $('#addSource tbody').html(thStr)

                window.bigData.editmoduledata.map(item => {
                    if($(e.target).val() ==item.tableName){
                        $('#chk'+item.fieldname).prop('checked',true)
                    }
                })
            }
        })
    })
    $("#fgiSource").click((e) => {
        let addMbTr = $('#addMb tbody tr')
        window.bigData.editmoduledata =[]
        if(addMbTr.length > 0){
           $("#addMb tbody tr").each((i,v) => {
                let items = $(v)
                window.bigData.editmoduledata.push({
                    fieldname:items.children('.columnName').text(),
                    tableName:items.children('.tableName').text()
                })
            })
        }
        $("#sourceName").fadeToggle(500)
        $.ajax({
            url:urlConfig.host+'/module/findAllTableFromDB',
            data:'',
            success: function(data) {
                let str = '<option>请选择</option>'
                data.map(item => {
                    str += `<option>${item}</option>`
                })
                $("#fgiName").html(str)
                // fgiNameChange()

            }
        })

    })

    function selectAll(selectStatus){//传入参数（全选框的选中状态）
        //根据name属性获取到单选框的input，使用each方法循环设置所有单选框的选中状态
        if(selectStatus){
            $("input[name='check']").each(function(i,n){
            n.checked = true;
            });
        }else{
            $("input[name='check']").each(function(i,n){
            n.checked = false;
            });
        }
    }
    /**
     * 关闭模型二次删除确认框
    */
    function lkrFrameDelClose(){
        $('#lkrFrameDel').fadeToggle(500)
    }
    /**
     * 关闭新建参数模型框
    */
    function lkrFrameClose(){
        reseAddMb()
        $('#lkrFrame').fadeToggle(500)
    }
    function Confirm(){
        let mouldParam = []

        if(window.bigData.frameType == 'add'){
            $("#addMb tbody tr").each((i,v) => {
                let items = $(v)
                mouldParam.push({
                    fieldname:items.children('.columnName').text(),
                    fieldtype:items.children('.columnType').text(),
                    tablename:items.children('.tableName').text()
                    // id:null,
                    // moduleid:null,
                    // remark:null
                })
            })
            let param = {
                modulegroup:$("#modulegroup").val(),
                modulename:$("#mouldName").val(),
                modulefields:mouldParam,
                des:$("#mouldRemark").val(),
                // sqlurl:null,
                remark:'',
                // id:null
            }
            console.log(param)
            $.ajax({
                url:urlConfig.host+'/module/addModule',
                type:'post',
                dataType: 'json',
                data:JSON.stringify(param),
                contentType: "application/json;charset=UTF-8",//指定消息请求类型
                success: function(data) {
                    $(".moduleContentList").html('')
                    toastr.success('保存成功！');
                    $.ajax({
                        url:urlConfig.host+'/module/GetAllModule',
                        data:'',
                        success: function(data) {
                            if(data){
                                let str=``
                                data.map(item=>{
                                    $(".moduleContentList").append(`<div class="left-list">
                                            <div class="left-list-tilte dbclickModule" data-id='${item.id}'>${item.modulename}</div>
                                            <div class="left-list-event">
                                                <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                                                <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                                            </div>
                                        </div>`)
                                })
                            }
                        }
                    })
                    $('#lkrFrame').fadeToggle(500)
                }

            })
        }else{
            $("#addMb tbody tr").each((i,v) => {
                let items = $(v)
                let id=0
                if(items.attr("id")){
                    id = items.attr("id")
                }
                let obj = {
                    fieldname:items.children('.columnName').text(),
                    fieldtype:items.children('.columnType').text(),
                    tablename:items.children('.tableName').text(),
                    id:id,
                    moduleid:window.bigData.editmoduleId,
                    // remark:null
                }
                mouldParam.push(obj)
            })

            let param = {
                id:window.bigData.editmoduleId,
                modulegroup:$("#modulegroup").val(),
                modulename:$("#mouldName").val(),
                modulefields:mouldParam,
                des:$("#mouldRemark").val(),
                tab:$('#fgiName').val() == '请选择'?'':$('#fgiName').val(),
                // sqlurl:null,
                remark:'',
                // id:null
            }
            console.log(param)
            $.ajax({
                url:urlConfig.host+'/module/modModuleById',
                type:'post',
                dataType: 'json',
                data:JSON.stringify(param),
                contentType: "application/json;charset=UTF-8",//指定消息请求类型
                success: function(data) {
                    $(".moduleContentList").html('')
                    toastr.success('修改成功！');
                    $.ajax({
                        url:urlConfig.host+'/module/GetAllModule',
                        data:'',
                        success: function(data) {
                            if(data){
                                let str=``
                                data.map(item=>{
                                    $(".moduleContentList").append(`<div class="left-list">
                                            <div class="left-list-tilte dbclickModule" data-id='${item.id}'>${item.modulename}</div>
                                            <div class="left-list-event">
                                                <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                                                <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                                            </div>
                                        </div>`)
                                })
                            }
                        }
                    })
                    $('#lkrFrame').fadeToggle(500)
                }

            })
        }


    }
    function reseTabs(){
        $.ajax({
            url:urlConfig.host+'/module/GetModuleGroup',
            data:'',
            success: function(data) {
                $("#pic_list li a").each((i,v) => {
                    console.log($(v).html())
                })
            }
        })
    }
    function reseAddMb(){
        $('#addMb tbody').html('')
        $("#mouldName").val('')
        $("#modulegroup").val('')
        $("#mouldRemark").val('')
        $("#modulegroup").prop('disabled',false)
        $("input:checkbox[name='item']").each((i,v) => {
            $(v).prop('checked',false)
        })
    }
    function reseTabsList(val){

        if(val == "全部"){

            $.ajax({
                url:urlConfig.host+'/module/GetAllModule',
                data:'',
                success: function(data) {
                    if(data){
                        debugger
                        $(".moduleContentList").html('')
                        let str=``
                        data.map(item=>{
                            $(".moduleContentList").append(`<div class="left-list">
                                    <div class="left-list-tilte dbclickModule"  data-id='${item.id}'>${item.modulename}</div>
                                    <div class="left-list-event">
                                        <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                                        <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                                    </div>
                                </div>`)
                        })
                    }
                }
            })
        }else{
            $.ajax({
            url:urlConfig.host+'/module/GetModuleByGroupName',
            data:{moduleGroupName:val},
            success: function(data) {
                // $(".left-list").remove()
                $(".moduleContentList").html('')
                data.map(item => {
                    $(".moduleContentList").append(`<div class="left-list">
                        <div class="left-list-tilte dbclickModule"  data-id='${item.id}'>${item.modulename}</div>
                        <div class="left-list-event">
                            <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                            <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                        </div>
                    </div>`)
                })
            }
        })
        }

    }
    function ConfirmDel(){
        $.ajax({
            url:urlConfig.host+'/module/delModuleById',
            data:{moduleId:window.bigData.delmoduleId},
            success: function(data) {
                if(data){
                    window.bigData.delmoduleId = ''
                    toastr.success('删除成功！');
                    $.ajax({
                        url:urlConfig.host+'/module/GetAllModule',
                        data:'',
                        success: function(data) {
                            if(data){
                                $(".moduleContentList").html('')
                                let str=``
                                data.map(item=>{
                                    $(".moduleContentList").append(`<div class="left-list">
                                            <div class="left-list-tilte dbclickModule" data-id='${item.id}'>${item.modulename}</div>
                                            <div class="left-list-event">
                                                <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                                                <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                                            </div>
                                        </div>`)
                                })
                            }
                        }
                    })
                    $('#lkrFrameDel').fadeToggle(500)
                }
            }
        })
    }

    function dataModlue(){
        $("#dicDiv").hide();
        $("#AddAlgorithm").hide();
        $.ajax({
            url:urlConfig.host+'/module/GetAllModule',
            data:'',
            success: function(data) {
                if(data){
                    $(".moduleContentList").html('')
                    let str=``
                    data.map(item=>{
                        $(".moduleContentList").append(`<div class="left-list">
                                <div class="left-list-tilte dbclickModule" data-id='${item.id}'>${item.modulename}</div>
                                <div class="left-list-event">
                                    <div class='lkr-list-edit lkr-edit' data-id='${item.id}' >编辑模型</div>
                                    <div class='lkr-list-del lkr-del' data-id='${item.id}' >删除模型</div>
                                </div>
                            </div>`)
                    })
                }
            }
        })
        $.ajax({
            url:urlConfig.host+'/module/GetModuleGroup',
            data:'',
            success: function(datas) {
                let str = '<option>全部</option>'
                datas.map(item => {
                    str += `<option>${item}</option>`
 
                })              
                $("#selectedModlue").html(str)
                

            }
        })
        $('#dataModulePage').fadeToggle(500)
    }
    $("#selectedModlue").change((e)=>{
      
        reseTabsList( $("#selectedModlue").val());
    })
    function ModuleClose(){
        $('#dataModulePage').fadeToggle(500)
    }
    function editAlgorithm(){
        $('#AddAlgorithm').fadeToggle(500);
        $("#dataModulePage").hide();
        $("#dicDiv").hide();
        window.bigData.formulaType = 'add';
    }
    function AlgorithmClose(){
        $('#AddAlgorithm').fadeToggle(500)
    }
    function sourceNameClose(){
        $('#addSource tbody').html('')
        $("#sourceName").fadeToggle(500)
    }
    function sourceNameConfirm(){
        let modlueList =[]
        $("input:checkbox[name='item']").each((i,v) => {
            let items = $(v)

            if(items.prop('checked')){
               let list = $(items).parent().nextAll()
            //    list.map(item =>{
            //     debugger
            //    })
                let obj ={
                    IS_NULLABLE:list.eq(4).text(),
                    COLUMN_NAME:list.eq(0).text(),
                    COLUMN_TYPE:list.eq(2).text(),
                    LENGTH:list.eq(3).text(),
                    COLUMN_COMMENT:list.eq(1).text(),
                    TABLE_NAME:$("#fgiName").val()
                }
                modlueList.push(obj)
            }
        })
        let thStr = ''
        modlueList.map(item => {
            thStr += `<tr>
            <td class="columnName">${item.COLUMN_NAME?item.COLUMN_NAME:''}</td>
            <td class="columnComment">${item.COLUMN_COMMENT?item.COLUMN_COMMENT:''}</td>
            <td class="columnType">${item.COLUMN_TYPE?item.COLUMN_TYPE:''}</td>
            <td>${item.LENGTH?item.LENGTH:''}</td>
            <td>${item.IS_NULLABLE?item.IS_NULLABLE:''}</td>
            <td class="tableName">${item.TABLE_NAME?item.TABLE_NAME:''}</td>
            <td><button class="delTab">删除</button></td></tr>`
        })
        $('#addMb tbody').html(thStr)
        $('#addSource tbody').html('')
        $("#sourceName").fadeToggle(500)
    }
    function AlgorithmConfirm(){
        let s = $('#sfType').val();
        $("#AddAlgorithm").hide();
        $(".Frame").hide();
        $(".Logic").hide();
        if(s == "算法公式"){
            $(".Frame").show();
            window.bigData.formulaType = 'add';
            $("#gsName").val("");
            $("#gsDes").val("");
            $("#AlgorithmnameY").val("");
            $("#MathInput").val("");
            $(".MathJaxEdit").empty();
            $("#gsName").attr("disabled",false);
            $("#gsDes").attr("disabled",false);
            $('#AlgorithmnameY').attr("disabled",false);
            $('#MathInput').attr("disabled",false);
            $('#MathInput').attr("disabled",false);
            $('.closeGsButton').show();
            $('#MathPreview').empty()
            $('#MathBuffer').empty()
        } else if(s == "逻辑运算"){
            $(".Logic").show();
            $('.closeLjButton').show();
            $('.LogicContent .addButton').show();
            $("#ljName").val("");
            $("#ljDes").val("");;
            $('#LogicName').val("");;
            $("#ljName").attr("disabled",false);
            $("#ljDes").attr("disabled",false);
            $('#LogicName').attr("disabled",false);
            $('.logicUl').empty();
            $(".logicUl").append(`
               <li class="logicLi">
                    <select name="" class="Logic-form-field inputButton">
                        <option value="">请选择字段</option>
                    </select>
                    <select name="" class="Logic-form-label inputButton">
                        <option value="">与</option>
                        <option value="">或</option>
                        <option value="">非</option>
                        <option value="">&lt; </option>
                        <option value="">&lt;=</option>
                        <option value="">&gt; </option>
                        <option value="">&gt;=</option>
                        <option value="">=</option>
                    </select>
                    <!-- <select name="" class="Logic-form-value inputButton">
                        <option value="">请选择取值</option>
                    </select>  -->
                    <input type="text" class="Logic-form-value inputButton">
                    <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                </li>
            `)
        }
    }
    function dictionary(){
        $("#dicTable").text("");
        $("#dataModulePage").hide();
        $("#AddAlgorithm").hide();
        $.ajax({
            url:urlConfig.host + "/operatorMaintenance/getAllAlgorithm",
            data:"",
            type:"get",
            success(data) {
                if(!data.length) return;
                console.log(data);
                $("#dicTable").append(`<thead>
                    <th style="width: 150px">作者</th>
                    <th style="width: 150px">算法名称</th>
                    <th style="width: 150px">算法描述</th>
                    <th style="width: 150px">操作</th>
                    </thead>`)
                data.map(s=>{
                    $("#dicTable").append(
                        `<tr class="dbclickAlgorithm" algorithmid="${s.tableAlgorithm.id}">
                            <td style="width: 150px" algorithmid="${s.tableAlgorithm.id}">${s.tableAlgorithm.algorithmauthor}</td>
                            <td style="width: 150px" algorithmid="${s.tableAlgorithm.id}">${s.tableAlgorithm.algorithmname}</td>
                            <td style="width: 150px" algorithmid="${s.tableAlgorithm.id}">${s.tableAlgorithm.des}</td>
                            <td style="width: 150px" algorithmid="${s.tableAlgorithm.id}">
                                <input type="button" onclick="editZd(${s.tableAlgorithm.id})" class="dicEdit" value="修改" style="height: 30px;line-height: 30px;background: #409eff;margin-right: 15px;border: none">
                                <input type="button" onclick="deleteZd(${s.tableAlgorithm.id})" value="删除" style="height: 30px;line-height: 30px;background: #f56c6c;border: none">
                            </td>
                        </tr>
                       `)
                })
            }
        })
    }
    function dictionaryShow(){
        $("#dicDiv").show()
        dictionary()
    }
    //删除字典信息
    function deleteZd(s) {
        $.ajax({
            url:urlConfig.host + "/operatorMaintenance/delAlgorithmById",
            data:{algthId:s} ,
            type:"get",
            success(data) {
                if(data.status == 1){
                    dictionary()
                    toastr.success('删除成功！');
                    Topology.init();
                }
                if(data.status == 2){
                    toastr.info(data.msg);
                }
            }
        })
    }

    //修改字典信息
    function editZd(s) {
        $("#editDicYes").attr("editId",s)
        $.ajax({
            url:urlConfig.host +"/operatorMaintenance/getAlgorithmById",
            data:{algthId:s} ,
            type:"get",
            success(data) {
                console.log(data);
                if(data.tableAlgorithm.algorithmtype == 1){
                    $("#editDicYes").show();
                    $("#editDicName").val("");
                    $("#editDicDes").val("");
                    $("#editAuthor").val("")
                    $("#editAuthor").attr("disabled",false);
                    $("#editDicName").attr("disabled",false);
                    $("#editDicDes").attr("disabled",false);
                    $("#editDicName").val(data.tableAlgorithm.algorithmname);
                    $("#editDicDes").val(data.tableAlgorithm.des);
                    $("#editAuthor").val(data.tableAlgorithm.algorithmauthor)
                    $("#zdcsList").empty()
                    $("#addZdcs").show();
                    $("#editDic").show();
                    data.tableFuncs.map(t=>{
                        $("#zdcsList").append(`
                         <div divId="${t.id}" class="zdcsDiv " style="margin-bottom: 15px">
                            <p style="margin-top: 5px">
                                <span style="color:#fff;margin-right: 20px;">参数名称</span>
                                <input class="zdcsCsmc" type="text" value="${t.varname}">
                            </p>
                            <p>
                                <span style="color:#fff;margin-right: 20px">类型</span>
                                <select class="zdcsSelect">
                                    <option value="2">常量</option>
                                    <option value="3">对象</option>
                                    <option value="1">基本类型</option>
                                </select>
                            </p>
                            <p>
                                <span style="color:#fff;;margin-right: 20px">取值</span>
                                <input type="text" value="" class="zdcsText">
                            </p>
                            <p>
                                <span style="color:#fff;margin-right: 20px">输入输出</span>
                                <select class="zdcsExport">
                                    <option value="0">输入</option>
                                    <option value="1">输出</option>
                                </select>
                                <button class="deleteZdcs" style="float: right;margin-right: 20px;background: #f56c6c;border: none;color: #fff;height: 30px;line-height: 30px">删除</button>
                            </p>
                        </div>
                    `)
                    })
                    for(var i=0;i<data.tableFuncs.length;i++){
                        $("#editDic .zdcsSelect").eq(i).val(data.tableFuncs[i].vartype)
                        $("#editDic .zdcsExport").eq(i).val(data.tableFuncs[i].inorout)
                        if(data.tableFuncs[i].vartype == 2 || data.tableFuncs[i].vartype == 3){
                            $("#editDic .zdcsText").eq(i).val(data.tableFuncs[i].valvalue)
                        } else {
                            $("#editDic .zdcsText").eq(i).hide();
                            let select= $(`
                            <select class="zdcsTypeSelect">
                                <option>int</option>
                                <option>long</option>
                                <option>byte</option>
                                <option>short</option>
                                <option>float</option>
                                <option>double</option>
                                <option>boolean</option>
                                <option>char</option>
                                <option>date</option>
                                <option>string</option>
                                <option>BLOB</option>
                                <option>boolean</option>
                                <option>array</option>
                            </select>`)
                            select.val(data.tableFuncs[i].valvalue)
                            $("#editDic .zdcsSelect").eq(i).parent().next().find("span").text("数据项")
                            $("#editDic .zdcsSelect").eq(i).parent().next().append(select)
                        }
                    }
                } else if(data.tableAlgorithm.algorithmtype == 2){
                    $('.closeGsButton').show();
                    $("#gsName").val("");
                    $("#gsDes").val("");
                    $("#MathInput").val("");
                    $('#AlgorithmnameY').val("");
                    $("#gsName").val(data.tableAlgorithm.algorithmauthor);
                    $("#gsDes").val(data.tableAlgorithm.des);
                    $('#AlgorithmnameY').val(data.tableAlgorithm.algorithmname)
                    $('#AlgorithmnameY').attr({"value":data.tableAlgorithm.algorithmname,"tableAlgorithmid":data.tableAlgorithm.id,"tableAlmoduleid":data.tableAlgorithm.moduleid});
                    window.bigData.editFormula = data.tableAlgorithm.algorithmfun
                    window.changeBds(data.tableAlgorithm.algorithmfun);
                    window.bigData.formulaType = 'edit';
                    if(data.tableFuncs.length>0){
                        let str =``
                        data.tableFuncs.map((item)=>{
                            str +=`<div class="MathJaxParam" formulaid="${item.id}" formulaModuleId="${item.algorithmid}">
                                        <div class="width-50">
                                            <span>变量</span>
                                            <input type="text" readonly="readonly" value="${item.varname}" class="MathJaxInput1 inputButton">
                                        </div>
                                        <div class="width-50 width-select">
                                            <span>类型</span>
                                            <select  class="MathJaxInput2 inputButton">
                                                <option value="2">常量</option>
                                                <option value="1">基本类型</option>
                                            </select>
                                        </div>
                                        <div class="width-50 isShow1">
                                                <span>取值</span >
                                                <input type="text" class="MathJaxInput3 inputButton">
                                        </div>
                                        <div class="width-50 isShow2">
                                            <span>基本类型</span>
                                            <select class="MathJaxSelect  MathJaxInput1 inputButton">
                                                <option>byte</option>
                                                <option>short</option>
                                                <option>int</option>
                                                <option>long</option>
                                                <option>float</option>
                                                <option>double</option>
                                                <option>boolean</option>
                                                <option>char</option>
                                                <option>date</option>
                                                <option>string</option>
                                                <option>BLOB</option>
                                                <option>boolean</option>
                                                <option>array</option>
                                            </select>
                                        </div>
                                        <div class="width-50">
                                                <span>描述</span>
                                                <input type="text" class="MathJaxInput4 inputButton" value="${item.remark}">
                                        </div>
                                    </div>`
                        })
                        $(".MathJaxEdit").html(str)
                        for(let j=0;j<data.tableFuncs.length;j++){
                            for(k=0;k<$('.MathJaxParam').length;k++){
                                let vType = data.tableFuncs[j].vartype
                                if(j == k){
                                    $('.MathJaxParam').eq(k).find(".MathJaxInput2").find("option[value='"+vType+"']").attr("selected",true);
                                    if(vType == "2"){
                                        $('.MathJaxParam').eq(k).find('.isShow2').attr("style","display:none;");
                                        $('.MathJaxParam').eq(k).find(".isShow1").attr("style","display:block;");
                                        $('.MathJaxParam').eq(k).find(".isShow1").find('input').attr("value",data.tableFuncs[j].valvalue)
                                    }
                                    if(vType == "1"){
                                        $('.MathJaxParam').eq(k).find('.isShow1').attr("style","display:none;");
                                        $('.MathJaxParam').eq(k).find(".isShow2").attr("style","display:block;");
                                        $('.MathJaxParam').eq(k).find(".isShow2").find('input').attr("value",data.tableFuncs[j].valvalue)
                                        $('.MathJaxParam').eq(k).find(".MathJaxSelect").val(data.tableFuncs[j].valvalue)
                                    }
                                }
                            }
                        }
                    }
                    $('.Frame').fadeToggle(500)
                } else if(data.tableAlgorithm.algorithmtype == 3){
                    window.bigData.formulaType = 'edit';
                    $('.closeLjButton').show();
                    $('#LogicName').attr({"value":data.tableAlgorithm.algorithmname,"tableAlgorithmid":data.tableAlgorithm.id,"tableAlmoduleid":data.tableAlgorithm.moduleid});
                    $("#ljName").val(data.tableAlgorithm.algorithmauthor);
                    $('#ljDes').val(data.tableAlgorithm.des);
                    let algorithmfun = data.tableAlgorithm.algorithmfun;
                    $.ajax({
                        url:urlConfig.host+'/module/getModuleColumns',
                        data:{moduleId:window.bigData.formulaModuleId},
                        success: function(data) {
                            let str1 =``
                            if(data.length>0){
                                data.map(item => {
                                    str1 += `<option value="${item.fieldname}">${item.fieldname}</option>`
                                })
                                $('.Logic-form-field').html(str1)
                            }

                            algorithmfun = algorithmfun.split(" and ")
                            let str =``
                            for(let i=0;i<algorithmfun.length;i++){
                                if(algorithmfun[i].indexOf('与') !=-1){
                                    let obj = algorithmfun[i].split("与")
                                    str+=` <li class="logicLi">
                                                <select name="" class="Logic-form-field inputButton">
                                                    <option value="">${obj[0]}</option>
                                                </select>
                                                <select name="" class="Logic-form-label inputButton">
                                                    <option value="" selected>与</option>
                                                    <option value="">或</option>
                                                    <option value="">非</option>
                                                    <option value="">&lt;</option>
                                                    <option value="">&lt;=</option>
                                                    <option value="">&gt;</option>
                                                    <option value="">&gt;=</option>
                                                    <option value="">=</option>
                                                </select>
                                                <!-- <select name="" class="Logic-form-value inputButton">
                                                    <option value="">请选择取值</option>
                                                </select>  -->
                                                <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                                <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                            </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if(algorithmfun[i].indexOf('或') !=-1){
                                    let obj = algorithmfun[i].split("或")
                                    str+=` <li class="logicLi">
                                                <select name="" class="Logic-form-field inputButton">
                                                    <option value="">${obj[0]}</option>
                                                </select>
                                                <select name="" class="Logic-form-label inputButton">
                                                    <option value="">与</option>
                                                    <option value="" selected>或</option>
                                                    <option value="">非</option>
                                                    <option value="">&lt;</option>
                                                    <option value="">&lt;=</option>
                                                    <option value="">&gt;</option>
                                                    <option value="">&gt;=</option>
                                                    <option value="">=</option>
                                                </select>
                                                <!-- <select name="" class="Logic-form-value inputButton">
                                                    <option value="">请选择取值</option>
                                                </select>  -->
                                                <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                                <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                            </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if(algorithmfun[i].indexOf('非') !=-1){
                                    let obj = algorithmfun[i].split("非")
                                    str+=` <li class="logicLi">
                                            <select name="" class="Logic-form-field inputButton">
                                                <option value="">${obj[0]}</option>
                                            </select>
                                            <select name="" class="Logic-form-label inputButton">
                                                <option value="">与</option>
                                                <option value="">或</option>
                                                <option value="" selected>非</option>
                                                <option value="">&lt;</option>
                                                <option value="">&lt;=</option>
                                                <option value="">&gt;</option>
                                                <option value="">&gt;=</option>
                                                <option value="">=</option>
                                            </select>
                                            <!-- <select name="" class="Logic-form-value inputButton">
                                                <option value="">请选择取值</option>
                                            </select>  -->
                                            <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                            <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                        </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if((algorithmfun[i].indexOf('<') !=-1) && (algorithmfun[i].indexOf('<=') == -1)){
                                    let obj = algorithmfun[i].split("<")
                                    str+=` <li class="logicLi">
                                                <select name="" class="Logic-form-field inputButton">
                                                    <option value="">${obj[0]}</option>
                                                </select>
                                                <select name="" class="Logic-form-label inputButton">
                                                    <option value="">与</option>
                                                    <option value="">或</option>
                                                    <option value="">非</option>
                                                    <option value="" selected>&lt;</option>
                                                    <option value="">&lt;=</option>
                                                    <option value="">&gt;</option>
                                                    <option value="">&gt;=</option>
                                                    <option value="">=</option>
                                                </select>
                                                <!-- <select name="" class="Logic-form-value inputButton">
                                                    <option value="">请选择取值</option>
                                                </select>  -->
                                                <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                                <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                            </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if((algorithmfun[i].indexOf('<=') !=-1) && (algorithmfun[i].indexOf('<') !=-1)  && (algorithmfun[i].indexOf('=') !=-1)){
                                    let obj = algorithmfun[i].split("<=")
                                    str+=` <li class="logicLi">
                                                <select name="" class="Logic-form-field inputButton">
                                                    <option value="">${obj[0]}</option>
                                                </select>
                                                <select name="" class="Logic-form-label inputButton">
                                                    <option value="">与</option>
                                                    <option value="">或</option>
                                                    <option value="">非</option>
                                                    <option value="">&lt;</option>
                                                    <option value="" selected>&lt;=</option>
                                                    <option value="">&gt;</option>
                                                    <option value="">&gt;=</option>
                                                    <option value="">=</option>
                                                </select>
                                                <!-- <select name="" class="Logic-form-value inputButton">
                                                    <option value="">请选择取值</option>
                                                </select>  -->
                                                <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                                <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                            </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if((algorithmfun[i].indexOf('>') !=-1) && (algorithmfun[i].indexOf('>=') == -1)){
                                    let obj = algorithmfun[i].split(">")
                                    str+=` <li class="logicLi">
                                            <select name="" class="Logic-form-field inputButton">
                                                <option value="">${obj[0]}</option>
                                            </select>
                                            <select name="" class="Logic-form-label inputButton">
                                                <option value="">与</option>
                                                <option value="">或</option>
                                                <option value="">非</option>
                                                <option value="">&lt;</option>
                                                <option value="">&lt;=</option>
                                                <option value="" selected>&gt;</option>
                                                <option value="">  &gt;=</option>
                                                <option value="">=</option>
                                            </select>
                                            <!-- <select name="" class="Logic-form-value inputButton">
                                                <option value="">请选择取值</option>
                                            </select>  -->
                                            <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                            <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                        </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if((algorithmfun[i].indexOf('=') !=-1) && (algorithmfun[i].indexOf('>') !=-1) && (algorithmfun[i].indexOf('>=') !=-1)){
                                    let obj = algorithmfun[i].split(">=")
                                    str+=` <li class="logicLi">
                                                <select name="" class="Logic-form-field inputButton">
                                                    <option value="">${obj[0]}</option>
                                                </select>
                                                <select name="" class="Logic-form-label inputButton">
                                                    <option value="">与</option>
                                                    <option value="">或</option>
                                                    <option value="">非</option>
                                                    <option value="">&lt;</option>
                                                    <option value="">&lt;=</option>
                                                    <option value="">&gt;</option>
                                                    <option value="" selected>&gt;=</option>
                                                    <option value="">=</option>
                                                </select>
                                                <!-- <select name="" class="Logic-form-value inputButton">
                                                    <option value="">请选择取值</option>
                                                </select>  -->
                                                <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                                <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                            </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }
                                if((algorithmfun[i].indexOf('=') !=-1) && (algorithmfun[i].indexOf('>') ==-1) && (algorithmfun[i].indexOf('<') == -1)){
                                    let obj = algorithmfun[i].split("=")
                                    str+=` <li class="logicLi">
                                            <select name="" class="Logic-form-field inputButton">
                                                <option value="">${obj[0]}</option>
                                            </select>
                                            <select name="" class="Logic-form-label inputButton">
                                                <option value="">与</option>
                                                <option value="">或</option>
                                                <option value="">非</option>
                                                <option value="">&lt;</option>
                                                <option value="">&lt;=</option>
                                                <option value="">&gt;</option>
                                                <option value="">&gt;=</option>
                                                <option value="" selected>=</option>
                                            </select>
                                            <!-- <select name="" class="Logic-form-value inputButton">
                                                <option value="">请选择取值</option>
                                            </select>  -->
                                            <input type="text" class="Logic-form-value inputButton" value="${obj[1]}">
                                            <button class="removeLogic" type="button" onclick="removeLogic(event)">删除</button>
                                        </li>`
                                    $('.logicLi').eq(i).find(".Logic-form-field").find("option[value='"+obj[0]+"']").attr("selected",true);
                                }


                            }
                            $('.logicUl').html(str)
                            $('.Logic').fadeToggle(500)
                        }
                    })
                }
            }
        })
    }
    //逻辑运算新增按钮
    function addLogic(){
        $(".logicUl").append($(".logicLi:first").clone());
    }
    $("#searchName").bind('input propertychange',function(s){
        let val = $("#searchName").val()
        $('.left-list').each((i,s)=>{
            if($(s).children().text().includes(val)){
                $(s).show()
            } else {
                $(s).hide()
            }
        })
    });
           
</script>
</body>
</html>
